<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BAND-MAID Songs</title>
<link rel="icon" type="image/png" href="favicon.png">
<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  margin: 20px;
}
h1 {
  margin-bottom: 15px;
}
input[type="text"] {
  width: 100%;
  max-width: 400px;
  padding: 8px;
  margin: 5px 5px 15px 0;
  font-size: 14px;
  border: 1px solid #444;
  border-radius: 4px;
  background: #222;
  color: #eee;
}
.song {
  margin-bottom: 10px;
  padding: 10px;
  border: 1px solid #444;
  border-radius: 5px;
}
.song-header {
  cursor: pointer;
  font-weight: bold;
  background: #222;
  padding: 10px;
  border-radius: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.song-header:hover {
  background: #333;
}
.details {
  display: none;
  background: #1a1a1a;
  margin-top: 8px;
  padding: 10px;
  border-radius: 5px;
  white-space: pre-wrap;
}
.details a {
  color: #66ccff;
  text-decoration: none;
}
.details a:hover {
  text-decoration: underline;
}
pre {
  white-space: pre-wrap;
  word-wrap: break-word;
}
</style>
</head>
<body>

<h1>BAND-MAID Songs</h1>

<input id="filterName" type="text" placeholder="Filter by song name...">
<input id="filterAlbum" type="text" placeholder="Filter by album...">

<div id="songs"></div>

<script>
let songsData = [];

// Load and sort songs
fetch('songs.json')
  .then(r => r.json())
  .then(data => {
    songsData = data.sort((a, b) => {
      const dA = new Date(a.ReleaseDate);
      const dB = new Date(b.ReleaseDate);
      if (dA - dB !== 0) return dA - dB;
      return a.Name.localeCompare(b.Name);
    });
    renderSongs();
  })
  .catch(err => {
    console.error('Error loading songs.json:', err);
    document.getElementById('songs').textContent = 'Failed to load songs.';
  });

function renderSongs() {
  const nameFilter = document.getElementById('filterName').value.toLowerCase().trim();
  const albumFilter = document.getElementById('filterAlbum').value.toLowerCase().trim();
  const container = document.getElementById('songs');
  container.innerHTML = '';

  songsData.forEach(song => {
    const nameMatch = !nameFilter || song.Name.toLowerCase().includes(nameFilter);
    const albumMatch = !albumFilter || (song.Album && song.Album.toLowerCase().includes(albumFilter));
    if (!nameMatch || !albumMatch) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'song';

    const header = document.createElement('div');
    header.className = 'song-header';
    header.textContent = `${song.Name} â€” ${song.Album} (${song.ReleaseDate.split('T')[0]})`;

    const details = document.createElement('div');
    details.className = 'details';

    let html = '<table>';

    for (const key in song) {
           if (song[key] === null || song[key] === undefined || song[key] === '') continue;

           let value = song[key];

           // Format numbers with commas
           if (typeof value === 'number' && 
            (key === 'SpotifyStreams' || key === 'YouTubeTotalStreams')) {
              value = value.toLocaleString();
           }

           // Convert string numbers to formatted numbers too
           if (typeof value === 'string' &&
               !isNaN(value) &&
               (key === 'SpotifyStreams' || key === 'YouTubeTotalStreams')) {
            value = Number(value).toLocaleString();
           }

           if (key === 'LyricsURL' || key === 'EnglishLyricsURL') {
               value = `<a href="${value}" target="_blank">${value}</a>`;
           } else if (typeof value === 'string' && value.includes('\n')) {
               value = `<pre>${value}</pre>`;
           }

           html += `<tr><td><strong>${key}</strong>:</td><td>${value}</td></tr>`;
   }


    html += '</table>';
    details.innerHTML = html;

    header.addEventListener('click', () => {
      details.style.display = details.style.display === 'block' ? 'none' : 'block';
    });

    wrapper.appendChild(header);
    wrapper.appendChild(details);
    container.appendChild(wrapper);
  });
}

// Live filters
document.getElementById('filterName').addEventListener('input', renderSongs);
document.getElementById('filterAlbum').addEventListener('input', renderSongs);
</script>

</body>
</html>
